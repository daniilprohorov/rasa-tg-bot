# Задание

Первое (практическое):

Разобраться с фреймворком RASA и сделать простой чат бот в телеграмме с его помощью
https://rasa.com/docs/rasa/

1) Выбрать домен для чат-бота
2) Написать 5-6 примеров диалога между пользователем и системой (по 5 реплик с каждой стороны)
3) Нарисовать блок-схему диалогов
4) Разработать прототип с помощью  RASA
5) Интегрировать в Телеграм
6) Рассказать о библиотеке и показать результат на лекции
Примеры блок-схем в этом туториале https://chatbotslife.com/dialogflow-restaurant-bot-tutorial-d29b665eb975

# Предметная область бота

В автомобильной группе в TG не всегда можно запомнить каждого участника, и какая у него машина,
поэтому удобно иметь какого-то бота, в который человек загрузил информацию о своей машине, ссылки на какие-то ресурсы, фотографию автомобиля;
После чего можно тегнуть этого бота ответом на сообщение человека в группе и получить ту информацию, ссылки и фото, которые он сохранил.

# Примеры подобных ботов

Что-то подобное есть для велосипедов в @velach_bot:
- /checkbike ответом на фото можно загрузить фотографию своего велосипеда
- /bikecheck ответом на любое сообщение человека в группе, можно посмотреть фото его велосипеда

Что-то подобное есть в боте в Вастрик клубе:
- /whois ответом на любое сообщение человека в группе, можно получить краткое описание с сайта клуба, а также ссылку на личную страницу в клубе

# Блок-схемы:

## V1 Блок схемы созданные при планировании бота
<details>
  <summary>Общая диаграмма</summary>

  ![v1.0](/pics/tgBotDialog.drawio.v1.0.png)
</details>

<details>
  <summary>Примеры диалогов</summary>

  ![v1.1](/pics/tgBotDialog.drawio.v1.1.png)

  ![v1.2](/pics/tgBotDialog.drawio.v1.2.png)

  ![v1.3](/pics/tgBotDialog.drawio.v1.3.png)
</details>

## V2 Блок схемы финальной версии бота
<details>
  <summary>Общая диаграмма</summary>

  ![v1.0](/pics/tgBotDialog.drawio.v2.0.png)
</details>

<details>
  <summary>Примеры диалогов</summary>

  ![v1.1](/pics/tgBotDialog.drawio.v2.1.png)
</details>

# Примеры

<details>
  <summary>Пример диалога в ТГ</summary>

  ![example](/pics/tgExample.png)
</details>

# Сложности с которыми столкнулся в процессе

## Персональные особенности
1) Никогда не делал ботов
2) Не прямо погружен в NLP и подобные штуки

## Особнности RASA

В целом очень странная штука, которую не так просто понять, как мне кажется, я за примерно 100 часов понял только основы, и честно говоря мне не очень понравилось.
По крайней мере для решения моей задачи.

1) Описывать логику в yml файлах для программиста как-то будто не очень привычно,
потому что нет никакого автодополнения, jumpToDefinition, и подобных вспомогательных средств,
поэтому все происходит как в блокноте. Я видел расширение для RASA для vscode, но они выглядят устаревшими.
Возможно предполагается, что это будут делать в массе своей люди не особо владеющие навыками программирования,  но для меня это было непривычно.
Pycharm мне вообще часто предлагал этот файл удалить по какой-то причине.
Ну и сначала было сложно разобраться какой файл за что отвечает, потому что это не прям совсем очевидно со всеми конфигурационными файлами.

2) Не понравилось, что надо в нескольких местах прописывать тоже самое, например, ты в одном месте описал intent, потом ты обязательно его должен прописать в списке intents, зачем, как-то не очень понятно.
Конечно, можно подумать, что это было бы актуально, если нужно не использовать какие-то intent, но можно просто закомментировать этот код, или сделать это объявление не обязательным. Тоже самое относится к entities.
Возможно это из-за того, что они разнесены по разным файлам, но это все еще не очень удобно.

3) Также не понравилось, что нельзя просто вывести какой-то текст, надо обязательно формировать его в utter_ в responses, это актуально, когда этот ответ будет использоваться в нескольких местах,
но если требуется вывести сообщение только один раз, то было бы классно чтобы это сделал фреймворк RASA без моего явного прописывания.

4) Разделение переменных на slots и entities. Идея понятна, что entities это низкоуровневые переменные, а слоты, более высокоуровневые, но как будто не мешает это упростить,
потому что часто просто происходит глупое перекладывание из entities в слоты

5) Проблема stories и rules. Истории это ML модель, которая работает не всегда так, как ты бы от нее хотел, потому что это все еще ML модель, и в документации говорится,
что используйте rules, если вам нужно что-то, что будет работать так как вы пропишете в 100 процентах случаев. Это все нормально бы работало, если бы у них был идентичный функционал.
Потому что в rules нет чекпоинтов, множественных intent, и or, хотя вот все могли бы это сделать. А получается, что идея хорошая, а реализация, по крайней мере с моими настройками не очень,
потому что чекпоинты иногда могут просто не работать, а работать только иногда, а при этом в rules сложно описать что-то длинное, потому что нельзя использовать несколько intent, это как бы с одной стороны логично,
но с другой, получается, что мы ничего не можем сделать хорошо, система не может в 100 из 100 случаев обработать введенное сообщение так как мы запланировали в истории, но и каким-то супер интеллектом она не обладает,
чтобы проанализировать какой-то очень сложный кейс, по крайней мере по моемы опыту.

6) Система не использует информацию из категориальных слотов. Например, если мы в intent получаем какое-то entity, которое потом используется только в одном категориальном слоте, то логично, то это entity,
может принимать значение только этого категориального слота. Так для обновления информации, мне нужно заполнять слот change_slot(engine/transmission/model/photo),
и я не могу просто написать в intent все варианты сообщений, из которой я хочу достать этот категориальный change_slot, мне надо было продублировать это все. Если бы я использовал обычный ЯП, я бы просто сделал такую регулярку,
с набором префиксов, постфиксов, из которой удобно вычленить нужный кусок, но в RASA так делать нельзя, ну или я не разобрался как.

7) Интеграция с Telegram очень низкая. Например, я не могу какими-то простыми способами вытащить фотографию из сообщения. На форуме RASA было сказано, что вы можете форкнуть RASA и написать сами реализацию, по вытаскиванию фото.
Я не обладаю такими знаниями, и желанием это делать, я бы прото хотел получить фото и все. Да и вообще в документации особо ничего не написано про то, как работать с TG, и информацию добывать достаточно сложно. Хотя при должном усилии, наверное можно сделать все.
Но я решил не выкачивать изображение, а просто просить скинуть фото ссылкой, и в ответе также размещать ссылку. Но в реальном боте, такое положение дел меня бы не устроило, потому что мало кто захочет заливать фото на файлохранилище, прежде чем скинуть его боту.

8) Интерактивный режим RASA. В документации RASA было написано, что желательно использовать rasa interactive, для построения и проверки работы stories, однако я попробовал, и мне не понравилось, какие истории получаются после интерактивного режима.
Там очень прямолинейно записывается набор intent и actions, не используя уже готовые куски, которые занимаются тем же самым, и получается, что обрабатывается какой-то отдельный кейс, и вместо того, чтобы написать конфиг так, чтобы он применялся во многих ситуациях
и переиспользовался, от нас хотят, чтобы мы просто захардкодили все возможные варианты развития диалога, и записали их прямолинейно в конфиг. Возможно это реально рабочий способ, но потом читать эти конфиги невозможно. Возможно, если взаимодействие с этими конфигами проходит через
какую-то дополнительную информационную систему, это вариант рабочий, но мне не понравилось, хотя задумка в целом неплохая.

9) Сложно описывать логику диалогов, если тебе не нужно что-то очень простое. Например для прерывания формы приходится городить какой-то собственный функционал со слотами, проверками, это все не выглядит как нормальное решение. И я уверен, что по крайней мере для моей задачи, обычный фреймворк для создания ботов + регулярный выражения + токенизатор + что-то типа парсер-комбинаторов, было бы логичнее, и работало бы лучше. Но опять же, возможно я просто не проникся, и требую чего-то не того. Т.е. хотелось как-то все разделить на какие-то компоненты, которые слаженно работают между собой, а в RASA как будто больше хотят, чтобы мы в тупую понаделали ctrl + c, ctrl + v, учитывая, что даже нет реализации or для rules, которая и убирает во многом этот ctrl + c, ctrl + v.

10) Можно сказать, что все можно сделать в custom_actions, да, это действительно так, но тогда ты потом как-то не понимаешь, а зачем вообще тебе RASA, если ты почти все собираешься описывать в custom_actions.

11) Вроде RASA не мертвая, но как будто сейчас она не на такой волне, как была раньше, и перспективы в ее изучении для чего-то промышленного я особо не вижу. Я действительно пытался проникнуться, и понять плюсы от использования RASA, и я не был как-то негативно к ней настроен, а наоборот, с воодушивлением,
да и опыта у меня никакого другого не было в построении ботов для TG, но чем глубже я погружался, и чем сложнее я хотел сделать систему, тем больше я понимал, что это или тяжело сделать, или работает не так, как я хочу.


# Вывод

Было достаточно интересно поизучать что-то новое и почитать про то, как работают диалоговые системы!
Делать бота мне понраилось, хотя иногда я бил кулаком по столу, когда что-то работало не так, как я хочу, и бот жестко тупил и не отвечал так, как я бы от него хотел!
Конечно, я думал, что получится сделать +- продакшн реди решение, которое я бы мог применить в группе по Citroen C2/C3, но в конечном итоге, я понял, что для моей задачи не нужна вариативность,
и лучше сделать ограниченного бота, в котором можно добавить фото, написать любое текстовое описаниеи, и прикрепить ссылку на профиль на drive2.ru. Но возможно, если мне надо будет делать какую-то сложную большую диалоговую систему,
то можно будет глубже изучить RASA и интегрировать ее как базовый уровень, в который автоматизированно добавлять правила с более выскокоуровневой системы.
